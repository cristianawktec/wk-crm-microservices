import{d as T,k as P,l as Z,m as D,n as L,o as n,c as l,e,g as c,t as p,h as g,p as m,q as x,s as C,F as N,x as I,w as S,i as b,T as O,r as V,_ as H,u as U,y as E,a as F,z as y,A,B as z}from"./index-ac3bb454.js";const q={class:"notification-bell"},K={key:0,class:"badge"},W={key:0,class:"notification-panel"},G={class:"panel-header"},J={class:"header-actions"},Q={class:"notifications-list"},X={key:0,class:"empty-state"},Y=["onClick"],ee={key:0,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},te={key:1,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},oe={key:2,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},se={key:3,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ne={class:"notification-content"},le={class:"timestamp"},ae={class:"notification-actions"},ie=["onClick"],re=["onClick"],ce={class:"panel-footer"},de=T({__name:"NotificationBell",setup(h){const i=V(!1),{notifications:_,unreadCount:d,init:u,loadNotifications:v,markAsRead:f,markAllAsRead:w,deleteNotification:M,cleanup:$}=P();Z(()=>{u();const r=setInterval(()=>{v()},3e4);D(()=>{clearInterval(r),$()})});function B(){i.value=!i.value}function a(){i.value=!1}function s(r){r.is_read||f(r.id),r.action_url&&(window.location.hash=`#${r.action_url}`,a())}return(r,t)=>{const k=L("router-link");return n(),l("div",q,[e("button",{onClick:B,class:m(["bell-button",{active:i.value}]),title:"Notificações"},[t[2]||(t[2]=e("svg",{class:"bell-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})],-1)),c(d)>0?(n(),l("span",K,p(c(d)>99?"99+":c(d)),1)):g("",!0)],2),x(O,{name:"panel-slide"},{default:C(()=>[i.value?(n(),l("div",W,[e("div",G,[t[5]||(t[5]=e("h3",null,"Notificações",-1)),e("div",J,[c(d)>0?(n(),l("button",{key:0,onClick:t[0]||(t[0]=(...o)=>c(w)&&c(w)(...o)),class:"btn-action",title:"Marcar todas como lidas"},[...t[3]||(t[3]=[e("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("path",{d:"M20 6L9 17l-5-5"})],-1)])])):g("",!0),e("button",{onClick:a,class:"btn-close"},[...t[4]||(t[4]=[e("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])]),e("div",Q,[c(_).length===0?(n(),l("div",X,[...t[6]||(t[6]=[e("p",null,"Nenhuma notificação",-1)])])):g("",!0),(n(!0),l(N,null,I(c(_),o=>(n(),l("div",{key:o.id,class:m(["notification-item",{unread:!o.is_read}]),onClick:j=>s(o)},[e("div",{class:m(["notification-icon",o.type])},[o.type==="opportunity_created"?(n(),l("svg",ee,[...t[7]||(t[7]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{d:"M12 8v8M8 12h8"},null,-1)])])):o.type==="opportunity_status_changed"?(n(),l("svg",te,[...t[8]||(t[8]=[e("path",{d:"M20 6L9 17l-5-5"},null,-1)])])):o.type==="opportunity_value_changed"?(n(),l("svg",oe,[...t[9]||(t[9]=[e("path",{d:"M12 2L15.09 8.26H22L17.64 12.61L19.16 18.97L12 15.77L4.84 18.97L6.36 12.61L2 8.26H8.91L12 2Z"},null,-1)])])):(n(),l("svg",se,[...t[10]||(t[10]=[e("circle",{cx:"12",cy:"12",r:"1"},null,-1),e("circle",{cx:"19",cy:"12",r:"1"},null,-1),e("circle",{cx:"5",cy:"12",r:"1"},null,-1)])]))],2),e("div",ne,[e("h4",null,p(o.title),1),e("p",null,p(o.message),1),e("span",le,p(o.created_at_formatted),1)]),e("div",ae,[o.is_read?g("",!0):(n(),l("button",{key:0,onClick:S(j=>c(f)(o.id),["stop"]),class:"btn-icon",title:"Marcar como lida"},[...t[11]||(t[11]=[e("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("path",{d:"M20 6L9 17l-5-5"})],-1)])],8,ie)),e("button",{onClick:S(j=>c(M)(o.id),["stop"]),class:"btn-icon danger",title:"Remover"},[...t[12]||(t[12]=[e("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,re)])],10,Y))),128))]),e("div",ce,[e("button",{class:"btn-secondary",onClick:t[1]||(t[1]=()=>c(v)())}," Atualizar "),x(k,{to:"/notifications",class:"btn-primary",onClick:a},{default:C(()=>[...t[13]||(t[13]=[b(" Ver Todas ",-1)])]),_:1})])])):g("",!0)]),_:1}),i.value?(n(),l("div",{key:0,class:"panel-overlay",onClick:a})):g("",!0)])}}});const ue=H(de,[["__scopeId","data-v-fd502672"]]);function pe(h,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function R(h,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"})])}function ve(h,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})])}function ge(h,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"})])}function he(h,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const we={class:"min-h-screen bg-gray-100"},me={class:"flex items-center justify-between p-4 border-b border-indigo-600"},xe={class:"p-4 space-y-2"},_e=["href"],fe={class:"lg:ml-64"},ke={class:"bg-white shadow-sm sticky top-0 z-20"},ye={class:"flex items-center justify-between px-4 py-3"},be={class:"flex-1 lg:ml-4"},Ce={class:"text-xl font-semibold text-gray-800"},Me={class:"flex items-center space-x-4"},$e={class:"flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg"},Be={class:"w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white font-semibold"},Ae={class:"hidden lg:block text-sm font-medium text-gray-700"},Le={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50"},Ne={class:"p-6"},je=T({__name:"AppLayout",setup(h){const i=U(),_=E(),d=F(),u=V(!1),v=V(!1),f=y(()=>{const a=d.user||{},s=Array.isArray(a.roles)?a.roles:[],r=a.role||"",t=(a.email||"").toLowerCase();return s.includes("admin")||r==="admin"?!0:t==="admin@consultoriawk.com"||t==="admin-test@wkcrm.local"}),w=y(()=>{const a=[{name:"Dashboard",path:"/",label:"Dashboard",icon:ve},{name:"Opportunities",path:"/opportunities",label:"Oportunidades",icon:R},{name:"Notifications",path:"/notifications",label:"Notificações",icon:pe},{name:"Trends",path:"/trends",label:"Análise de Tendências",icon:R},{name:"Profile",path:"/profile",label:"Meu Perfil",icon:he}];return f.value&&a.push({name:"LoginAudits",path:"/admin/#/admin/login-audits",label:"Acessos ao Sistema",icon:ge,external:!0}),a}),M=y(()=>{const a=w.value.find(s=>s.name===_.name);return(a==null?void 0:a.label)||"Dashboard"}),$=y(()=>{var s;return(((s=d.user)==null?void 0:s.name)||"U").split(" ").map(r=>r[0]).join("").toUpperCase().substring(0,2)}),B=async()=>{try{console.log("[logout] Usuario clicou em Sair"),v.value=!1,localStorage.setItem("loggedOut","true"),await d.logout(),console.log("[logout] Redirecionando para login..."),await i.push("/login"),console.log("[logout] Logout completo, redirecionado")}catch(a){console.error("[logout] Erro no processo de logout:",a),await i.push("/login")}};return(a,s)=>{var k;const r=L("router-link"),t=L("router-view");return n(),l("div",we,[e("aside",{class:m(["fixed inset-y-0 left-0 w-64 bg-indigo-700 text-white transform transition-transform duration-300 ease-in-out z-30 lg:translate-x-0",{"-translate-x-full":!u.value,"translate-x-0":u.value}])},[e("div",me,[s[6]||(s[6]=e("h1",{class:"text-xl font-bold"},"WK CRM",-1)),e("button",{onClick:s[0]||(s[0]=o=>u.value=!1),class:"lg:hidden"},[...s[5]||(s[5]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("nav",xe,[(n(!0),l(N,null,I(w.value,o=>(n(),l(N,{key:o.name},[o.external?(n(),l("a",{key:1,href:o.path,target:"_blank",rel:"noopener",class:"flex items-center px-4 py-3 rounded-lg transition-colors hover:bg-indigo-600"},[(n(),A(z(o.icon),{class:"w-5 h-5 mr-3"})),b(" "+p(o.label),1)],8,_e)):(n(),A(r,{key:0,to:o.path,class:m(["flex items-center px-4 py-3 rounded-lg transition-colors",a.$route.name===o.name?"bg-indigo-800":"hover:bg-indigo-600"])},{default:C(()=>[(n(),A(z(o.icon),{class:"w-5 h-5 mr-3"})),b(" "+p(o.label),1)]),_:2},1032,["to","class"]))],64))),128))])],2),e("div",fe,[e("header",ke,[e("div",ye,[e("button",{onClick:s[1]||(s[1]=o=>u.value=!u.value),class:"lg:hidden"},[...s[7]||(s[7]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),e("div",be,[e("h2",Ce,p(M.value),1)]),e("div",Me,[x(ue),e("div",{class:"relative",onClick:s[2]||(s[2]=o=>v.value=!v.value),onBlur:s[3]||(s[3]=o=>v.value=!1),tabindex:"0"},[e("button",$e,[e("div",Be,p($.value),1),e("span",Ae,p((k=c(d).user)==null?void 0:k.name),1)]),v.value?(n(),l("div",Le,[x(r,{to:"/profile",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:C(()=>[...s[8]||(s[8]=[b(" Meu Perfil ",-1)])]),_:1}),e("button",{onClick:B,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Sair ")])):g("",!0)],32)])])]),e("main",Ne,[x(t)])]),u.value?(n(),l("div",{key:0,onClick:s[4]||(s[4]=o=>u.value=!1),class:"fixed inset-0 bg-black bg-opacity-50 z-20 lg:hidden"})):g("",!0)])}}});export{je as default};
