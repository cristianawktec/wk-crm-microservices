import{d as z,r as $,k as T,l as I,m as P,n as B,o as s,c as n,e as t,g as r,t as w,h as g,p as f,q as m,s as b,F as R,x as S,w as A,i as L,T as D,_ as O,u as Z,y as H,a as U,z as V,A as E,B as F}from"./index-a3ac2e85.js";const q={class:"notification-bell"},K={key:0,class:"badge"},W={key:0,class:"notification-panel"},G={class:"panel-header"},J={class:"header-actions"},Q={class:"notifications-list"},X={key:0,class:"empty-state"},Y=["onClick"],tt={key:0,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},et={key:1,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},ot={key:2,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},st={key:3,class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},nt={class:"notification-content"},lt={class:"timestamp"},it={class:"notification-actions"},at=["onClick"],rt=["onClick"],dt={class:"panel-footer"},ct=z({__name:"NotificationBell",setup(x){const i=$(!1),{notifications:k,unreadCount:p,init:c,loadNotifications:v,markAsRead:_,markAllAsRead:y,deleteNotification:C,cleanup:M}=T();I(()=>{c();const u=setInterval(()=>{v()},3e4);P(()=>{clearInterval(u),M()})});function d(){i.value=!i.value}function o(){i.value=!1}function h(u){u.is_read||_(u.id),u.action_url&&(window.location.hash=`#${u.action_url}`,o())}return(u,e)=>{const a=B("router-link");return s(),n("div",q,[t("button",{onClick:d,class:f(["bell-button",{active:i.value}]),title:"Notificações"},[e[2]||(e[2]=t("svg",{class:"bell-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),t("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})],-1)),r(p)>0?(s(),n("span",K,w(r(p)>99?"99+":r(p)),1)):g("",!0)],2),m(D,{name:"panel-slide"},{default:b(()=>[i.value?(s(),n("div",W,[t("div",G,[e[5]||(e[5]=t("h3",null,"Notificações",-1)),t("div",J,[r(p)>0?(s(),n("button",{key:0,onClick:e[0]||(e[0]=(...l)=>r(y)&&r(y)(...l)),class:"btn-action",title:"Marcar todas como lidas"},[...e[3]||(e[3]=[t("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[t("path",{d:"M20 6L9 17l-5-5"})],-1)])])):g("",!0),t("button",{onClick:o,class:"btn-close"},[...e[4]||(e[4]=[t("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])])]),t("div",Q,[r(k).length===0?(s(),n("div",X,[...e[6]||(e[6]=[t("p",null,"Nenhuma notificação",-1)])])):g("",!0),(s(!0),n(R,null,S(r(k),l=>(s(),n("div",{key:l.id,class:f(["notification-item",{unread:!l.is_read}]),onClick:N=>h(l)},[t("div",{class:f(["notification-icon",l.type])},[l.type==="opportunity_created"?(s(),n("svg",tt,[...e[7]||(e[7]=[t("circle",{cx:"12",cy:"12",r:"10"},null,-1),t("path",{d:"M12 8v8M8 12h8"},null,-1)])])):l.type==="opportunity_status_changed"?(s(),n("svg",et,[...e[8]||(e[8]=[t("path",{d:"M20 6L9 17l-5-5"},null,-1)])])):l.type==="opportunity_value_changed"?(s(),n("svg",ot,[...e[9]||(e[9]=[t("path",{d:"M12 2L15.09 8.26H22L17.64 12.61L19.16 18.97L12 15.77L4.84 18.97L6.36 12.61L2 8.26H8.91L12 2Z"},null,-1)])])):(s(),n("svg",st,[...e[10]||(e[10]=[t("circle",{cx:"12",cy:"12",r:"1"},null,-1),t("circle",{cx:"19",cy:"12",r:"1"},null,-1),t("circle",{cx:"5",cy:"12",r:"1"},null,-1)])]))],2),t("div",nt,[t("h4",null,w(l.title),1),t("p",null,w(l.message),1),t("span",lt,w(l.created_at_formatted),1)]),t("div",it,[l.is_read?g("",!0):(s(),n("button",{key:0,onClick:A(N=>r(_)(l.id),["stop"]),class:"btn-icon",title:"Marcar como lida"},[...e[11]||(e[11]=[t("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[t("path",{d:"M20 6L9 17l-5-5"})],-1)])],8,at)),t("button",{onClick:A(N=>r(C)(l.id),["stop"]),class:"btn-icon danger",title:"Remover"},[...e[12]||(e[12]=[t("svg",{class:"icon-sm",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[t("polyline",{points:"3 6 5 6 21 6"}),t("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,rt)])],10,Y))),128))]),t("div",dt,[t("button",{class:"btn-secondary",onClick:e[1]||(e[1]=()=>r(v)())}," Atualizar "),m(a,{to:"/notifications",class:"btn-primary",onClick:o},{default:b(()=>[...e[13]||(e[13]=[L(" Ver Todas ",-1)])]),_:1})])])):g("",!0)]),_:1}),i.value?(s(),n("div",{key:0,class:"panel-overlay",onClick:o})):g("",!0)])}}});const ut=O(ct,[["__scopeId","data-v-fd502672"]]);function pt(x,i){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function j(x,i){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"})])}function vt(x,i){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})])}function gt(x,i){return s(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const wt={class:"min-h-screen bg-gray-100"},ht={class:"flex items-center justify-between p-4 border-b border-indigo-600"},mt={class:"p-4 space-y-2"},xt={class:"lg:ml-64"},_t={class:"bg-white shadow-sm sticky top-0 z-20"},ft={class:"flex items-center justify-between px-4 py-3"},kt={class:"flex-1 lg:ml-4"},yt={class:"text-xl font-semibold text-gray-800"},bt={class:"flex items-center space-x-4"},Ct={class:"flex items-center space-x-2 p-2 hover:bg-gray-100 rounded-lg"},Mt={class:"w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center text-white font-semibold"},$t={class:"hidden lg:block text-sm font-medium text-gray-700"},Bt={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-50"},Lt={class:"p-6"},At=z({__name:"AppLayout",setup(x){const i=Z(),k=H(),p=U(),c=$(!1),v=$(!1),_=[{name:"Dashboard",path:"/",label:"Dashboard",icon:vt},{name:"Opportunities",path:"/opportunities",label:"Oportunidades",icon:j},{name:"Notifications",path:"/notifications",label:"Notificações",icon:pt},{name:"Trends",path:"/trends",label:"Análise de Tendências",icon:j},{name:"Profile",path:"/profile",label:"Meu Perfil",icon:gt}],y=V(()=>{const d=_.find(o=>o.name===k.name);return(d==null?void 0:d.label)||"Dashboard"}),C=V(()=>{var o;return(((o=p.user)==null?void 0:o.name)||"U").split(" ").map(h=>h[0]).join("").toUpperCase().substring(0,2)}),M=async()=>{try{console.log("[logout] Usuario clicou em Sair"),v.value=!1,localStorage.setItem("loggedOut","true"),await p.logout(),console.log("[logout] Redirecionando para login..."),await i.push("/login"),console.log("[logout] Logout completo, redirecionado")}catch(d){console.error("[logout] Erro no processo de logout:",d),await i.push("/login")}};return(d,o)=>{var e;const h=B("router-link"),u=B("router-view");return s(),n("div",wt,[t("aside",{class:f(["fixed inset-y-0 left-0 w-64 bg-indigo-700 text-white transform transition-transform duration-300 ease-in-out z-30 lg:translate-x-0",{"-translate-x-full":!c.value,"translate-x-0":c.value}])},[t("div",ht,[o[6]||(o[6]=t("h1",{class:"text-xl font-bold"},"WK CRM",-1)),t("button",{onClick:o[0]||(o[0]=a=>c.value=!1),class:"lg:hidden"},[...o[5]||(o[5]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("nav",mt,[(s(),n(R,null,S(_,a=>m(h,{key:a.name,to:a.path,class:f(["flex items-center px-4 py-3 rounded-lg transition-colors",d.$route.name===a.name?"bg-indigo-800":"hover:bg-indigo-600"])},{default:b(()=>[(s(),E(F(a.icon),{class:"w-5 h-5 mr-3"})),L(" "+w(a.label),1)]),_:2},1032,["to","class"])),64))])],2),t("div",xt,[t("header",_t,[t("div",ft,[t("button",{onClick:o[1]||(o[1]=a=>c.value=!c.value),class:"lg:hidden"},[...o[7]||(o[7]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])]),t("div",kt,[t("h2",yt,w(y.value),1)]),t("div",bt,[m(ut),t("div",{class:"relative",onClick:o[2]||(o[2]=a=>v.value=!v.value),onBlur:o[3]||(o[3]=a=>v.value=!1),tabindex:"0"},[t("button",Ct,[t("div",Mt,w(C.value),1),t("span",$t,w((e=r(p).user)==null?void 0:e.name),1)]),v.value?(s(),n("div",Bt,[m(h,{to:"/profile",class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"},{default:b(()=>[...o[8]||(o[8]=[L(" Meu Perfil ",-1)])]),_:1}),t("button",{onClick:M,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"}," Sair ")])):g("",!0)],32)])])]),t("main",Lt,[m(u)])]),c.value?(s(),n("div",{key:0,onClick:o[4]||(o[4]=a=>c.value=!1),class:"fixed inset-0 bg-black bg-opacity-50 z-20 lg:hidden"})):g("",!0)])}}});export{At as default};
