import{d as L,b as q,l as H,c as r,e as t,f as u,v as x,D as V,j as M,F as N,x as P,t as n,h as w,q as J,r as i,C as h,o as l,p as A,i as E,_ as K}from"./index-60d55afe.js";import{A as Q}from"./AiAnalysisModal-1d7ae0b3.js";const W={class:"flex items-center justify-between mb-6"},X={class:"bg-white rounded-xl shadow-sm p-4 mb-6"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Z={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},ee={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},te={class:"flex items-start justify-between mb-4"},oe={class:"font-semibold text-lg text-gray-900"},se={class:"space-y-3"},ae={class:"flex items-center text-sm text-gray-600"},re={class:"font-semibold"},le={key:0,class:"flex items-center text-sm text-gray-600"},ne={key:1,class:"flex items-center text-sm text-gray-600"},ie={class:"pt-3 border-t border-gray-100"},de={class:"text-xs text-gray-500"},ue={key:2,class:"pt-2"},pe={class:"text-sm text-gray-600 line-clamp-2"},ce={class:"mt-4 flex items-center gap-2 pt-3 border-t border-gray-100"},be=["onClick"],ge=["onClick"],ve=["onClick"],me={key:2,class:"bg-white rounded-xl shadow-sm p-12 text-center"},xe={class:"text-gray-600"},ye={key:3,class:"fixed inset-0 z-40 flex items-center justify-center bg-black bg-opacity-50 px-4"},fe={class:"bg-white w-full max-w-2xl rounded-2xl shadow-xl p-6 relative"},we={class:"text-xl font-semibold text-gray-900 mb-4"},he={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},ke={class:"md:col-span-2"},_e={class:"md:col-span-2"},Ce={class:"flex justify-end space-x-3"},Ee=["disabled"],Oe=L({__name:"OpportunitiesView",setup(Ve){const k=i([]),_=i(!0),c=i(""),b=i("");let O=null;const p=q(),y=i(!1),f=i(!1),g=i(null),a=i({title:"",value:void 0,status:"Aberta",probability:void 0,notes:""}),v=i({isOpen:!1,opportunity:{}}),m=async()=>{_.value=!0;try{const s={};c.value&&(s.search=c.value),b.value&&(s.status=b.value);const e=await h.getOpportunities(s);k.value=Array.isArray(e.data)?e.data:[]}catch(s){console.error("Erro ao carregar oportunidades:",s)}finally{_.value=!1}},B=()=>{clearTimeout(O),O=setTimeout(()=>{m()},500)},j=async()=>{var s,e;if(!a.value.title.trim()){p.error("Título é obrigatório");return}f.value=!0;try{const o={title:a.value.title,value:a.value.value,probability:a.value.probability,status:a.value.status,notes:a.value.notes};g.value?(await h.updateOpportunity(g.value,o),p.success(`Oportunidade "${a.value.title}" atualizada com sucesso!`)):(await h.createOpportunity(o),p.success(`Oportunidade "${a.value.title}" criada com sucesso!`)),await m(),C()}catch(o){console.error("Erro ao salvar oportunidade:",o);const d=((e=(s=o.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao salvar oportunidade";p.error(d)}finally{f.value=!1}},S=s=>{g.value=s.id,a.value={title:s.title,value:s.value||void 0,status:s.status,probability:s.probability||void 0,notes:s.notes||""},y.value=!0},T=async s=>{var e,o;if(confirm(`Tem certeza que deseja excluir "${s.title}"?`))try{await h.deleteOpportunity(s.id),p.success(`Oportunidade "${s.title}" excluída com sucesso!`),await m()}catch(d){console.error("Erro ao excluir oportunidade:",d);const F=((o=(e=d.response)==null?void 0:e.data)==null?void 0:o.message)||"Erro ao excluir oportunidade";p.error(F)}},C=()=>{y.value=!1,g.value=null,a.value={title:"",value:void 0,status:"Aberta",probability:void 0,notes:""}},$=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),z=s=>s.seller?typeof s.seller=="string"?s.seller:s.seller.name||"Não atribuído":"Não atribuído",G=s=>{const e=new Date(s);return e.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})+" às "+e.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})},D=s=>({open:"Aberta",won:"Ganha",lost:"Perdida",negotiation:"Em Negociação",proposal:"Proposta Enviada",Aberta:"Aberta",Ganha:"Ganha",Perdida:"Perdida","Em Negociação":"Em Negociação","Proposta Enviada":"Proposta Enviada"})[s]||s,U=s=>({open:"bg-blue-100 text-blue-800",won:"bg-green-100 text-green-800",lost:"bg-red-100 text-red-800",negotiation:"bg-yellow-100 text-yellow-800",proposal:"bg-purple-100 text-purple-800",Aberta:"bg-blue-100 text-blue-800",Ganha:"bg-green-100 text-green-800",Perdida:"bg-red-100 text-red-800","Em Negociação":"bg-yellow-100 text-yellow-800","Proposta Enviada":"bg-purple-100 text-purple-800"})[s]||"bg-gray-100 text-gray-800",I=s=>({open:"border-blue-500",won:"border-green-500",lost:"border-red-500",negotiation:"border-yellow-500",proposal:"border-purple-500",Aberta:"border-blue-500",Ganha:"border-green-500",Perdida:"border-red-500","Em Negociação":"border-yellow-500","Proposta Enviada":"border-purple-500"})[s]||"border-gray-300",R=s=>{v.value.opportunity=s,v.value.isOpen=!0};return H(()=>{m()}),(s,e)=>(l(),r("div",null,[t("div",W,[e[9]||(e[9]=t("h1",{class:"text-2xl font-bold text-gray-900"},"Minhas Oportunidades",-1)),t("button",{class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",onClick:e[0]||(e[0]=o=>y.value=!0)}," Nova Oportunidade ")]),t("div",X,[t("div",Y,[t("div",null,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),type:"text",placeholder:"Buscar por título...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onInput:B},null,544),[[x,c.value]])]),t("div",null,[u(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",onChange:m},[...e[10]||(e[10]=[M('<option value="" data-v-179ebbf3>Todos os Status</option><option value="open" data-v-179ebbf3>Aberta</option><option value="negotiation" data-v-179ebbf3>Em Negociação</option><option value="proposal" data-v-179ebbf3>Proposta Enviada</option><option value="won" data-v-179ebbf3>Ganha</option><option value="lost" data-v-179ebbf3>Perdida</option>',6)])],544),[[V,b.value]])])])]),_.value?(l(),r("div",Z,[(l(),r(N,null,P(6,o=>t("div",{key:o,class:"bg-white rounded-xl shadow-sm p-6 animate-pulse"},[...e[11]||(e[11]=[t("div",{class:"h-4 bg-gray-200 rounded w-3/4 mb-4"},null,-1),t("div",{class:"h-6 bg-gray-200 rounded w-1/2 mb-4"},null,-1),t("div",{class:"h-3 bg-gray-200 rounded w-full mb-2"},null,-1),t("div",{class:"h-3 bg-gray-200 rounded w-2/3"},null,-1)])])),64))])):k.value.length>0?(l(),r("div",ee,[(l(!0),r(N,null,P(k.value,o=>(l(),r("div",{key:o.id,class:A(["bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow p-6 border-t-4",I(o.status)])},[t("div",te,[t("h3",oe,n(o.title),1),t("span",{class:A(["px-3 py-1 text-xs font-semibold rounded-full",U(o.status)])},n(D(o.status)),3)]),t("div",se,[t("div",ae,[e[12]||(e[12]=t("svg",{class:"w-5 h-5 mr-2 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),t("span",re,n($(o.value)),1)]),o.seller?(l(),r("div",le,[e[14]||(e[14]=t("svg",{class:"w-5 h-5 mr-2 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)),t("span",null,[e[13]||(e[13]=t("span",{class:"font-medium"},"Vendedor:",-1)),E(" "+n(z(o)),1)])])):w("",!0),o.probability?(l(),r("div",ne,[e[15]||(e[15]=t("svg",{class:"w-5 h-5 mr-2 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})],-1)),t("span",null,"Probabilidade: "+n(o.probability)+"%",1)])):w("",!0),t("div",ie,[t("p",de,[e[16]||(e[16]=t("span",{class:"font-medium"},"Criada:",-1)),E(" "+n(G(o.created_at)),1)])]),o.notes?(l(),r("div",ue,[e[17]||(e[17]=t("p",{class:"text-xs font-medium text-gray-500 mb-1"},"Observações:",-1)),t("p",pe,n(o.notes),1)])):w("",!0)]),t("div",ce,[t("button",{onClick:d=>R(o),class:"flex-1 px-3 py-2 text-sm bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition-colors flex items-center justify-center gap-1"},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),E(" Insights ",-1)])],8,be),t("button",{onClick:d=>S(o),class:"flex-1 px-3 py-2 text-sm bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 transition-colors"}," Editar ",8,ge),t("button",{onClick:d=>T(o),class:"flex-1 px-3 py-2 text-sm bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition-colors"}," Excluir ",8,ve)])],2))),128))])):(l(),r("div",me,[e[19]||(e[19]=t("svg",{class:"w-16 h-16 mx-auto text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),e[20]||(e[20]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Nenhuma oportunidade encontrada",-1)),t("p",xe,n(c.value||b.value?"Tente ajustar os filtros":"Você ainda não possui oportunidades cadastradas"),1)])),y.value?(l(),r("div",ye,[t("div",fe,[t("button",{class:"absolute top-3 right-3 text-gray-400 hover:text-gray-600",onClick:C},"✕"),t("h2",we,n(g.value?"Editar Oportunidade":"Nova Oportunidade"),1),t("div",he,[t("div",ke,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Título *",-1)),u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.title=o),type:"text",class:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Ex: Projeto CRM"},null,512),[[x,a.value.title]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Valor (R$)",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.value=o),type:"number",min:"0",step:"0.01",class:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"},null,512),[[x,a.value.value,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Probabilidade (%)",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.probability=o),type:"number",min:"0",max:"100",class:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"},null,512),[[x,a.value.probability,void 0,{number:!0}]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Status",-1)),u(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.status=o),class:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"},[...e[24]||(e[24]=[M('<option value="Aberta" data-v-179ebbf3>Aberta</option><option value="Em Negociação" data-v-179ebbf3>Em Negociação</option><option value="Proposta Enviada" data-v-179ebbf3>Proposta Enviada</option><option value="Ganha" data-v-179ebbf3>Ganha</option><option value="Perdida" data-v-179ebbf3>Perdida</option>',5)])],512),[[V,a.value.status]])]),t("div",_e,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Observações",-1)),u(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.notes=o),rows:"3",class:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500",placeholder:"Contexto, próximos passos, etc."},null,512),[[x,a.value.notes]])])]),t("div",Ce,[t("button",{class:"px-4 py-2 border rounded-lg text-gray-700 hover:bg-gray-50",onClick:C},"Cancelar"),t("button",{disabled:f.value,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50",onClick:j},n(f.value?"Salvando...":"Salvar"),9,Ee)])])])):w("",!0),J(Q,{"is-open":v.value.isOpen,opportunity:v.value.opportunity,onClose:e[8]||(e[8]=o=>v.value.isOpen=!1)},null,8,["is-open","opportunity"])]))}});const Pe=K(Oe,[["__scopeId","data-v-179ebbf3"]]);export{Pe as default};
