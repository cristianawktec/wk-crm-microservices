import{d as z,u as I,k as W,l as q,m as Z,H as j,z as k,c as s,e as o,f as P,D as L,g as T,h as r,F as G,x as J,t as i,r as f,o as l,p as A,i as $,_ as K}from"./index-60d55afe.js";const Q={class:"notifications-page"},X={class:"page-header"},Y={class:"header-actions"},ee={key:0,class:"notifications-container"},te={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},oe={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},ae={key:2,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},se={key:3,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor"},le={class:"card-content"},ne={class:"card-meta"},re={class:"date"},ie={key:0,class:"badge-unread"},de={key:0,class:"card-data"},ue={key:0,class:"data-item"},ce={key:1,class:"data-item"},ve={key:0},pe={key:1},ge={class:"card-actions"},_e=["onClick"],fe=["onClick"],me=["onClick"],we={key:0,class:"pagination"},ye=["disabled"],he={class:"page-info"},ke=["disabled"],$e={key:1,class:"empty-state"},m=20,Ne=z({__name:"NotificationsPage",setup(xe){const B=I(),{markAsRead:D,markAllAsRead:N,deleteNotification:R,cleanup:V}=W(),c=f(""),v=f(""),n=f(1),p=f([]),d=f(0);async function S(a){var e;console.log(`üóëÔ∏è NotificationsPage.deleteNotification called for: ${a}`),console.log(`Before delete - Total: ${d.value}, Current page: ${n.value}`),console.log(`Token in localStorage: ${(e=localStorage.getItem("token"))==null?void 0:e.substring(0,20)}...`),console.log(`Will call DELETE /api/notifications/${a}`);try{await R(a),console.log("‚úì serviceDeleteNotification completed"),console.log("üì° About to reload notifications..."),await new Promise(t=>setTimeout(t,500)),await g(),console.log("‚úì loadNotifications completed"),console.log(`After reload - Total: ${d.value}, Loaded items: ${p.value.length}`)}catch(t){console.error("‚ùå Error in deleteNotification:",t)}}async function x(a){console.log(`‚úì NotificationsPage: Marking as read ${a}`),await D(a)}let w;q(async()=>{await g(),w=setInterval(()=>{g()},3e4)}),Z(()=>{w&&clearInterval(w),V()});async function g(){try{const a=(n.value-1)*m,e=m;console.log(`üì° Loading notifications: limit=${e}, page=${n.value}, skip=${a}`);const t=await j.get(`/notifications?limit=${e}&page=${n.value}`);console.log("üì¶ Notifications response:",t.data),console.log(`Total from server: ${t.data.total}, Page: ${t.data.page}, Limit: ${t.data.limit}`),t.data.success?(p.value=t.data.data||[],d.value=t.data.total||0,console.log(`‚úÖ Loaded ${p.value.length} notifications, Total: ${d.value}`),console.log(`Total pages should be: ${Math.ceil(d.value/m)}`),console.log(`üìä Pagination: currentPage=${n.value}, totalPages=${_.value}, totalCount=${d.value}, itemsPerPage=${m}`),console.log(`Filtered notifications: ${y.value.length}`)):console.warn("‚ö†Ô∏è Response success is false:",t.data)}catch(a){console.error("‚ùå Error loading notifications:",a)}}const y=k(()=>p.value.filter(a=>!(c.value&&a.type!==c.value||v.value==="unread"&&a.is_read||v.value==="read"&&!a.is_read))),E=k(()=>p.value.some(a=>!a.is_read)),_=k(()=>Math.ceil(d.value/m));function H(a){if(a==="Agora")return"Agora";const e=new Date(a);if(isNaN(e.getTime()))return a;const u=new Date().getTime()-e.getTime(),h=Math.floor(u/6e4),b=Math.floor(u/36e5),M=Math.floor(u/864e5);return h<1?"Agora":h<60?`${h}m atr√°s`:b<24?`${b}h atr√°s`:M<7?`${M}d atr√°s`:e.toLocaleDateString("pt-BR")}function C(a){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a)}function U(a){if(!a.action_url)return;a.is_read||x(a.id);let e=a.action_url;try{const t=new URL(a.action_url,window.location.origin);e=(t.pathname||"/")+(t.search||"")+(t.hash||"")}catch{}e.startsWith("/")||(e="/"+e),B.push(e)}function F(){n.value>1&&(n.value--,g())}function O(){n.value<_.value&&(n.value++,g())}return(a,e)=>(l(),s("div",Q,[o("div",X,[e[5]||(e[5]=o("h1",null,"Notifica√ß√µes",-1)),o("div",Y,[P(o("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),class:"filter-select"},[...e[3]||(e[3]=[o("option",{value:""},"Todos os tipos",-1),o("option",{value:"opportunity_created"},"Oportunidades Criadas",-1),o("option",{value:"opportunity_status_changed"},"Status Alterado",-1),o("option",{value:"opportunity_value_changed"},"Valor Alterado",-1)])],512),[[L,c.value]]),P(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),class:"filter-select"},[...e[4]||(e[4]=[o("option",{value:""},"Todas",-1),o("option",{value:"unread"},"N√£o lidas",-1),o("option",{value:"read"},"Lidas",-1)])],512),[[L,v.value]]),E.value?(l(),s("button",{key:0,onClick:e[2]||(e[2]=(...t)=>T(N)&&T(N)(...t)),class:"btn-action"}," Marcar todas como lidas ")):r("",!0)])]),y.value.length>0?(l(),s("div",ee,[(l(!0),s(G,null,J(y.value,t=>(l(),s("div",{key:t.id,class:A(["notification-card",{unread:!t.is_read}])},[o("div",{class:A(["card-icon",t.type])},[t.type==="opportunity_created"?(l(),s("svg",te,[...e[6]||(e[6]=[o("circle",{cx:"12",cy:"12",r:"10"},null,-1),o("path",{d:"M12 8v8M8 12h8",stroke:"white","stroke-width":"2"},null,-1)])])):t.type==="opportunity_status_changed"?(l(),s("svg",oe,[...e[7]||(e[7]=[o("path",{d:"M20 6L9 17l-5-5",stroke:"white","stroke-width":"2"},null,-1)])])):t.type==="opportunity_value_changed"?(l(),s("svg",ae,[...e[8]||(e[8]=[o("path",{d:"M12 2L15.09 8.26H22L17.64 12.61L19.16 18.97L12 15.77L4.84 18.97L6.36 12.61L2 8.26H8.91L12 2Z"},null,-1)])])):(l(),s("svg",se,[...e[9]||(e[9]=[o("circle",{cx:"12",cy:"12",r:"1"},null,-1),o("circle",{cx:"19",cy:"12",r:"1"},null,-1),o("circle",{cx:"5",cy:"12",r:"1"},null,-1)])]))],2),o("div",le,[o("h3",null,i(t.title),1),o("p",null,i(t.message),1),o("div",ne,[o("span",re,i(H(t.created_at_formatted)),1),t.is_read?r("",!0):(l(),s("span",ie," N√£o lida "))]),t.data?(l(),s("div",de,[t.data.opportunity?(l(),s("div",ue,[e[10]||(e[10]=o("strong",null,"Oportunidade:",-1)),$(" "+i(t.data.opportunity.name),1)])):r("",!0),t.data.old_value||t.data.new_value?(l(),s("div",ce,[t.data.old_value?(l(),s("span",ve,[e[11]||(e[11]=o("strong",null,"De:",-1)),$(" R$ "+i(C(t.data.old_value)),1)])):r("",!0),t.data.new_value?(l(),s("span",pe,[e[12]||(e[12]=o("strong",null,"Para:",-1)),$(" R$ "+i(C(t.data.new_value)),1)])):r("",!0)])):r("",!0)])):r("",!0)]),o("div",ge,[t.is_read?r("",!0):(l(),s("button",{key:0,onClick:u=>x(t.id),class:"btn-mark-read",title:"Marcar como lida"},[...e[13]||(e[13]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[o("path",{d:"M20 6L9 17l-5-5"})],-1)])],8,_e)),t.action_url?(l(),s("button",{key:1,onClick:u=>U(t),class:"btn-view"}," Ver Detalhes ",8,fe)):r("",!0),o("button",{onClick:u=>S(t.id),class:"btn-delete",title:"Remover"},[...e[14]||(e[14]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[o("polyline",{points:"3 6 5 6 21 6"}),o("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})],-1)])],8,me)])],2))),128)),_.value>1?(l(),s("div",we,[o("button",{disabled:n.value===1,onClick:F,class:"btn-pagination"}," Anterior ",8,ye),o("span",he," P√°gina "+i(n.value)+" de "+i(_.value),1),o("button",{disabled:n.value===_.value,onClick:O,class:"btn-pagination"}," Pr√≥xima ",8,ke)])):r("",!0)])):(l(),s("div",$e,[e[15]||(e[15]=o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},[o("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),o("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})],-1)),e[16]||(e[16]=o("h2",null,"Nenhuma notifica√ß√£o",-1)),o("p",null,"Voc√™ n√£o tem notifica√ß√µes"+i(c.value||v.value?" que correspondem aos filtros":""),1)]))]))}});const be=K(Ne,[["__scopeId","data-v-3371e4e4"]]);export{be as default};
