import{d as I,E as D,c as r,e,t as c,p as C,G as E,h as m,i as F,F as L,x as S,r as b,C as T,o as n,_ as O}from"./index-9430d62f.js";const P={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},V={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-90vh overflow-y-auto"},G={key:0,class:"p-8 flex flex-col items-center justify-center"},U={key:1,class:"p-6"},q={class:"bg-red-50 border border-red-200 rounded-lg p-4"},H={class:"flex items-start gap-3"},J={class:"text-red-700 text-sm mt-1"},K={key:2,class:"p-6 space-y-6"},Q={class:"space-y-3"},W={class:"flex items-center justify-between"},X={class:"space-y-2"},Y={class:"w-full bg-gray-200 rounded-full h-3 overflow-hidden"},Z={class:"flex justify-between text-xs text-gray-600"},$={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ee={class:"text-blue-800 text-sm leading-relaxed"},te={key:1,class:"bg-green-50 border border-green-200 rounded-lg p-4"},se={class:"text-green-800 text-sm"},oe={key:2,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},ie={class:"text-yellow-800 text-sm leading-relaxed"},re={key:3,class:"space-y-3"},ne={class:"space-y-2"},ae={class:"text-gray-700 text-sm"},le={key:4,class:"border-t pt-4 text-xs text-gray-500"},de={key:0},ue={class:"bg-gray-50 px-6 py-4 flex justify-end gap-3 border-t"},ce=I({__name:"AiAnalysisModal",props:{isOpen:{type:Boolean,default:!1},opportunity:{default:null}},emits:["close"],setup(_,{emit:M}){const l=_,R=M,y=b(!1),p=b(""),o=b(null),x=b(!1);D(()=>l.isOpen,i=>{i&&l.opportunity?f():i||(o.value=null,p.value="",x.value=!1)});async function f(){var i,t,v;if(l.opportunity){y.value=!0,p.value="",o.value=null;try{const d=await T.getOpportunityInsights({id:l.opportunity.id,title:l.opportunity.title,value:l.opportunity.value,probability:l.opportunity.probability,status:l.opportunity.status,description:l.opportunity.notes||l.opportunity.title});console.log("üì¶ Raw API Response:",d);const a=(d==null?void 0:d.data)??d;if(console.log("üì¶ Extracted Payload:",a),!a){p.value="N√£o foi poss√≠vel analisar a oportunidade";return}const g=(a==null?void 0:a.data)??(a==null?void 0:a.analysis)??a,s=(g==null?void 0:g.data)??(g==null?void 0:g.analysis)??g;console.log("üì¶ RawAnalysis (will normalize):",s);const k=s.risk_score??s.riskScore??s.risk??s.score??0;let u=Number(k);Number.isFinite(u)||(u=0),u>=0&&u<=1&&(u=u*100),u=Math.max(0,Math.min(100,Math.round(u))),console.log("üîç AI Analysis Debug:",{rawScore:k,normalizedScore:u,risk_label:s.risk_label,summary:(i=s.summary)==null?void 0:i.substring(0,50)});const B=typeof s.summary=="string"?s.summary:"";x.value=[s.model,s.source,B].some(A=>typeof A=="string"&&/fallback|timeout|falha ao consultar|servi√ßo de ia/i.test(A));const w={risk_score:u,risk_label:(s.risk_label??s.riskLabel??s.risk_level??s.riskLevel??"Desconhecido").toString(),summary:s.summary??s.overview??s.description??"",next_action:s.next_action??s.nextAction??s.action??"",recommendation:s.recommendation??s.recommendations??s.tip??"",insights:Array.isArray(s.insights)?s.insights:s.key_insights?Array.isArray(s.key_insights)?s.key_insights:[s.key_insights]:[],created_at:s.created_at??s.createdAt??a.created_at??a.createdAt,processing_time_ms:s.processing_time_ms??s.processingTimeMs??s.time_ms};console.log("‚úÖ Normalized Analysis:",w),o.value=w}catch(d){console.error("Erro ao analisar:",d),p.value=((v=(t=d.response)==null?void 0:t.data)==null?void 0:v.message)||"Erro ao analisar oportunidade"}finally{y.value=!1}}}function h(){R("close")}function z(i){if(!i)return"bg-gray-100 text-gray-800";const t=i.toLowerCase();return t==="baixo"||t==="low"?"bg-green-100 text-green-800":t==="m√©dio"||t==="medium"?"bg-yellow-100 text-yellow-800":t==="alto"||t==="high"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}function N(i){return i<30?"bg-green-500":i<70?"bg-yellow-500":"bg-red-500"}function j(i){if(!i)return"‚Äî";try{return new Intl.DateTimeFormat("pt-BR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(i))}catch{return i}}return(i,t)=>{var v;return _.isOpen?(n(),r("div",P,[e("div",V,[e("div",{class:"bg-gradient-to-r from-indigo-600 to-indigo-700 px-6 py-4 flex items-center justify-between"},[t[1]||(t[1]=e("div",{class:"flex items-center gap-3"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5.36-5.36l.707-.707M5.05 5.05A9 9 0 1112 3c-4.4 0-8.27 2.903-9.657 6.82"})]),e("h2",{class:"text-xl font-bold text-white"},"An√°lise de IA")],-1)),e("button",{onClick:h,class:"text-white hover:bg-white hover:bg-opacity-20 p-1 rounded"},[...t[0]||(t[0]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),y.value?(n(),r("div",G,[...t[2]||(t[2]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"},null,-1),e("p",{class:"text-gray-600"},"Analisando oportunidade com IA...",-1)])])):p.value?(n(),r("div",U,[e("div",q,[e("div",H,[t[4]||(t[4]=e("svg",{class:"w-6 h-6 text-red-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[t[3]||(t[3]=e("h3",{class:"font-medium text-red-900"},"Erro ao analisar",-1)),e("p",J,c(p.value),1)])]),e("button",{onClick:f,class:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors text-sm font-medium"}," Tentar Novamente ")])])):o.value?(n(),r("div",K,[e("div",Q,[e("div",W,[t[5]||(t[5]=e("h3",{class:"font-semibold text-gray-900"},"N√≠vel de Risco",-1)),e("span",{class:C([z(o.value.risk_label),"px-3 py-1 rounded-full text-sm font-medium"])},c(((v=o.value.risk_label)==null?void 0:v.toUpperCase())||"N/A"),3)]),e("div",X,[e("div",Y,[e("div",{class:C([N(o.value.risk_score),"h-full transition-all duration-300"]),style:E({width:o.value.risk_score+"%"})},null,6)]),e("div",Z,[t[6]||(t[6]=e("span",null,"Baixo Risco",-1)),e("span",null,c(o.value.risk_score)+"%",1),t[7]||(t[7]=e("span",null,"Alto Risco",-1))])])]),o.value.summary?(n(),r("div",$,[t[8]||(t[8]=e("h3",{class:"font-semibold text-blue-900 mb-2"},"Resumo",-1)),e("p",ee,c(o.value.summary),1)])):m("",!0),o.value.next_action?(n(),r("div",te,[t[9]||(t[9]=e("h3",{class:"font-semibold text-green-900 mb-2 flex items-center gap-2"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})]),F(" Pr√≥xima A√ß√£o Recomendada ")],-1)),e("p",se,c(o.value.next_action),1)])):m("",!0),o.value.recommendation?(n(),r("div",oe,[t[10]||(t[10]=e("h3",{class:"font-semibold text-yellow-900 mb-2"},"Recomenda√ß√£o",-1)),e("p",ie,c(o.value.recommendation),1)])):m("",!0),o.value.insights&&o.value.insights.length>0?(n(),r("div",re,[t[12]||(t[12]=e("h3",{class:"font-semibold text-gray-900"},"Insights Principais",-1)),e("ul",ne,[(n(!0),r(L,null,S(o.value.insights,(d,a)=>(n(),r("li",{key:a,class:"flex gap-3"},[t[11]||(t[11]=e("span",{class:"text-indigo-600 font-bold text-sm"},"‚Ä¢",-1)),e("span",ae,c(d),1)]))),128))])])):m("",!0),o.value.created_at?(n(),r("div",le,[e("p",null,"An√°lise realizada em: "+c(j(o.value.created_at)),1),o.value.processing_time_ms?(n(),r("p",de,"Tempo de processamento: "+c(o.value.processing_time_ms)+"ms",1)):m("",!0)])):m("",!0)])):m("",!0),e("div",ue,[e("button",{onClick:h,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium"}," Fechar "),!y.value&&x.value?(n(),r("button",{key:0,onClick:f,class:"px-4 py-2 border border-indigo-300 text-indigo-700 rounded-lg hover:bg-indigo-50 transition-colors font-medium"}," Tentar novamente ")):m("",!0),!y.value&&!x.value?(n(),r("button",{key:1,onClick:f,class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"},c(o.value?"Analisar Novamente":"Analisar"),1)):m("",!0)])])])):m("",!0)}}});const ge=O(ce,[["__scopeId","data-v-07a50a50"]]);export{ge as A};
