{"ast":null,"code":"import Chart from 'chart.js/auto';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/common\";\nfunction DashboardComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 16);\n    i0.ɵɵelement(1, \"i\", 17);\n    i0.ɵɵtext(2, \" Carregando dados...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nfunction DashboardComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19)(1, \"div\", 20)(2, \"div\", 21)(3, \"div\", 22)(4, \"h3\", 23);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 24);\n    i0.ɵɵtext(7, \"Total Clientes\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 25);\n    i0.ɵɵelement(9, \"i\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"a\", 27);\n    i0.ɵɵtext(11, \"Mais info \");\n    i0.ɵɵelement(12, \"i\", 28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"div\", 20)(14, \"div\", 29)(15, \"div\", 22)(16, \"h3\", 23);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(18, \"p\", 24);\n    i0.ɵɵtext(19, \"Vendas do M\\u00EAs\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(20, \"div\", 25);\n    i0.ɵɵelement(21, \"i\", 30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"a\", 31);\n    i0.ɵɵtext(23, \"Mais info \");\n    i0.ɵɵelement(24, \"i\", 28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(25, \"div\", 20)(26, \"div\", 32)(27, \"div\", 22)(28, \"h3\", 23);\n    i0.ɵɵtext(29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"p\", 24);\n    i0.ɵɵtext(31, \"Oportunidades Ativas\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(32, \"div\", 25);\n    i0.ɵɵelement(33, \"i\", 33);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"a\", 34);\n    i0.ɵɵtext(35, \"Mais info \");\n    i0.ɵɵelement(36, \"i\", 28);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(37, \"div\", 20)(38, \"div\", 35)(39, \"div\", 22)(40, \"h3\", 23);\n    i0.ɵɵtext(41);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(42, \"p\", 24);\n    i0.ɵɵtext(43, \"Tickets Abertos\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(44, \"div\", 25);\n    i0.ɵɵelement(45, \"i\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(46, \"a\", 37);\n    i0.ɵɵtext(47, \"Mais info \");\n    i0.ɵɵelement(48, \"i\", 28);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    let tmp_1_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    let tmp_4_0;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate((tmp_1_0 = (tmp_1_0 = ctx_r0.stats.total_clientes) !== null && tmp_1_0 !== undefined ? tmp_1_0 : ctx_r0.stats.total_customers) !== null && tmp_1_0 !== undefined ? tmp_1_0 : 0);\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate((tmp_2_0 = (tmp_2_0 = ctx_r0.stats.receita_mes) !== null && tmp_2_0 !== undefined ? tmp_2_0 : ctx_r0.stats.salesThisMonth) !== null && tmp_2_0 !== undefined ? tmp_2_0 : \"R$ 0,00\");\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate((tmp_3_0 = (tmp_3_0 = ctx_r0.stats.leads_ativos) !== null && tmp_3_0 !== undefined ? tmp_3_0 : ctx_r0.stats.activeOpportunities) !== null && tmp_3_0 !== undefined ? tmp_3_0 : 0);\n    i0.ɵɵadvance(12);\n    i0.ɵɵtextInterpolate((tmp_4_0 = (tmp_4_0 = ctx_r0.stats.tickets_abertos) !== null && tmp_4_0 !== undefined ? tmp_4_0 : ctx_r0.stats.supportTickets) !== null && tmp_4_0 !== undefined ? tmp_4_0 : 0);\n  }\n}\nfunction DashboardComponent_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 38)(1, \"section\", 39)(2, \"div\", 40)(3, \"div\", 41)(4, \"h3\", 42);\n    i0.ɵɵelement(5, \"i\", 43);\n    i0.ɵɵtext(6, \"Vendas Mensais\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 44)(8, \"div\", 45)(9, \"div\", 46);\n    i0.ɵɵelement(10, \"canvas\", 47);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(11, \"div\", 40)(12, \"div\", 41)(13, \"h3\", 42);\n    i0.ɵɵelement(14, \"i\", 48);\n    i0.ɵɵtext(15, \"Atividade Recente\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 44)(17, \"div\", 49)(18, \"div\", 50);\n    i0.ɵɵelement(19, \"i\", 17);\n    i0.ɵɵtext(20, \" Carregando atividades...\");\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(21, \"section\", 51)(22, \"div\", 40)(23, \"div\", 41)(24, \"h3\", 42);\n    i0.ɵɵelement(25, \"i\", 52);\n    i0.ɵɵtext(26, \"Performance de Vendedores\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"div\", 44)(28, \"div\", 53)(29, \"div\", 50);\n    i0.ɵɵelement(30, \"i\", 17);\n    i0.ɵɵtext(31, \" Carregando performance...\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(api) {\n      this.api = api;\n      this.loading = true;\n      this.stats = {};\n      this.errorMessage = null;\n    }\n    ngOnInit() {\n      this.loadStats();\n    }\n    loadStats() {\n      this.loading = true;\n      this.api.getDashboard().subscribe({\n        next: v => {\n          if (v && v.resumo) {\n            this.stats = v.resumo;\n          } else if (v) {\n            // legacy / fallback format\n            this.stats = {\n              total_customers: v.totalCustomers || 0,\n              receita_mes: v.salesThisMonth || 0,\n              leads_ativos: v.activeOpportunities || 0,\n              tickets_abertos: v.supportTickets || 0\n            };\n          } else {\n            this.stats = {\n              total_customers: 0,\n              receita_mes: 0,\n              leads_ativos: 0,\n              tickets_abertos: 0\n            };\n          }\n          // If enhanced grafics available, render charts and feeds\n          if (v && v.dados_graficos) {\n            this.updateDashboardCharts(v.dados_graficos);\n          }\n          if (v && v.atividade_recente) {\n            this.updateActivityFeed(v.atividade_recente);\n          }\n          if (v && v.performance_vendedores) {\n            this.updatePerformanceTable(v.performance_vendedores);\n          }\n          this.loading = false;\n        },\n        error: err => {\n          this.loading = false;\n          this.errorMessage = 'Falha ao carregar o dashboard. Verifique se o backend está em execução.';\n          console.error('Dashboard load error', err);\n        }\n      });\n    }\n    updateDashboardCharts(dadosGraficos) {\n      try {\n        const vendas = (dadosGraficos.vendas_mes || []).slice(-30);\n        const revenueCtx = document.getElementById('revenue-chart-canvas')?.getContext('2d');\n        if (revenueCtx) {\n          // destroy existing chart instance if present\n          if (window.revenueChart instanceof Chart) window.revenueChart.destroy();\n          window.revenueChart = new Chart(revenueCtx, {\n            type: 'line',\n            data: {\n              labels: vendas.map(v => new Date(v.data).toLocaleDateString('pt-BR', {\n                month: 'short',\n                day: 'numeric'\n              })),\n              datasets: [{\n                label: 'Vendas (R$)',\n                data: vendas.map(v => v.valor || 0),\n                borderColor: 'rgb(75,192,192)',\n                backgroundColor: 'rgba(75,192,192,0.2)',\n                tension: 0.1\n              }]\n            },\n            options: {\n              responsive: true,\n              maintainAspectRatio: false\n            }\n          });\n        }\n        const salesCtx = document.getElementById('sales-chart-canvas')?.getContext('2d');\n        if (salesCtx) {\n          if (window.salesChart instanceof Chart) window.salesChart.destroy();\n          window.salesChart = new Chart(salesCtx, {\n            type: 'bar',\n            data: {\n              labels: vendas.map(v => new Date(v.data).toLocaleDateString('pt-BR', {\n                month: 'short',\n                day: 'numeric'\n              })),\n              datasets: [{\n                label: 'Vendas',\n                data: vendas.map(v => v.vendas || 0),\n                backgroundColor: 'rgba(54,162,235,0.6)'\n              }]\n            },\n            options: {\n              responsive: true,\n              maintainAspectRatio: false\n            }\n          });\n        }\n      } catch (err) {\n        console.warn('Erro ao renderizar charts', err);\n      }\n    }\n    updateActivityFeed(atividadeRecente) {\n      const activityContainer = document.querySelector('.activity-feed') || document.querySelector('#activity-feed');\n      if (!activityContainer) return;\n      const activityHtml = atividadeRecente.map(atividade => `\n      <div class=\"activity-item\">\n        <i class=\"fas fa-${atividade.tipo || 'info-circle'} activity-icon\"></i>\n        <div class=\"activity-content\">\n          <p class=\"activity-text\">${atividade.descricao || atividade.title || ''}</p>\n          <small class=\"activity-time text-muted\">${atividade.tempo || atividade.time || ''}</small>\n        </div>\n      </div>\n    `).join('');\n      activityContainer.innerHTML = activityHtml;\n    }\n    updatePerformanceTable(performanceVendedores) {\n      const tableContainer = document.querySelector('#performance-table') || document.querySelector('.performance-table');\n      if (!tableContainer) return;\n      const tableHtml = `\n      <table class=\"table table-striped\">\n        <thead><tr><th>Vendedor</th><th>Vendas</th><th>Leads</th><th>Conversão</th><th>Meta</th><th>Atingimento</th></tr></thead>\n        <tbody>\n          ${performanceVendedores.map(v => `\n            <tr>\n              <td>${v.nome}</td>\n              <td>${v.vendas}</td>\n              <td>${v.leads}</td>\n              <td>${(v.conversao || 0).toFixed ? v.conversao.toFixed(1) + '%' : v.conversao}</td>\n              <td>${v.meta}</td>\n              <td><span class=\"badge badge-${v.atingimento >= 90 ? 'success' : v.atingimento >= 70 ? 'warning' : 'danger'}\">${(v.atingimento || 0).toFixed ? v.atingimento.toFixed(1) + '%' : v.atingimento}</span></td>\n            </tr>\n          `).join('')}\n        </tbody>\n      </table>\n    `;\n      tableContainer.innerHTML = tableHtml;\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || DashboardComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        decls: 21,\n        vars: 4,\n        consts: [[1, \"content-wrapper\"], [1, \"content-header\"], [1, \"container-fluid\"], [1, \"row\", \"mb-2\"], [1, \"col-sm-6\"], [1, \"m-0\"], [1, \"breadcrumb\", \"float-sm-right\"], [1, \"breadcrumb-item\"], [\"href\", \"#\"], [1, \"breadcrumb-item\", \"active\"], [1, \"content\"], [\"id\", \"alert-container\"], [\"id\", \"stats-loading\", \"class\", \"text-center\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [\"class\", \"row\", \"id\", \"dashboard-container\", 4, \"ngIf\"], [\"class\", \"row\", 4, \"ngIf\"], [\"id\", \"stats-loading\", 1, \"text-center\"], [1, \"fas\", \"fa-spinner\", \"fa-spin\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\"], [\"id\", \"dashboard-container\", 1, \"row\"], [1, \"col-lg-3\", \"col-6\"], [\"data-card\", \"total-customers\", 1, \"small-box\", \"bg-info\"], [1, \"inner\"], [1, \"card-value\"], [1, \"card-label\"], [1, \"icon\"], [1, \"fas\", \"fa-users\"], [\"href\", \"#/customers\", 1, \"small-box-footer\"], [1, \"fas\", \"fa-arrow-circle-right\"], [\"data-card\", \"monthly-sales\", 1, \"small-box\", \"bg-success\"], [1, \"fas\", \"fa-chart-line\"], [\"href\", \"#/sales\", 1, \"small-box-footer\"], [\"data-card\", \"active-opportunities\", 1, \"small-box\", \"bg-warning\"], [1, \"fas\", \"fa-handshake\"], [\"href\", \"#/opportunities\", 1, \"small-box-footer\"], [\"data-card\", \"support-tickets\", 1, \"small-box\", \"bg-danger\"], [1, \"fas\", \"fa-ticket-alt\"], [\"href\", \"#/support\", 1, \"small-box-footer\"], [1, \"row\"], [1, \"col-lg-7\", \"connectedSortable\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"fas\", \"fa-chart-pie\", \"mr-1\"], [1, \"card-body\"], [1, \"tab-content\", \"p-0\"], [\"id\", \"revenue-chart\", 1, \"chart\", \"tab-pane\", \"active\", 2, \"position\", \"relative\", \"height\", \"300px\"], [\"id\", \"revenue-chart-canvas\", \"height\", \"300\", 2, \"height\", \"300px\"], [1, \"fas\", \"fa-clock\", \"mr-1\"], [\"id\", \"activity-feed\", 1, \"activity-feed\"], [1, \"text-center\"], [1, \"col-lg-5\", \"connectedSortable\"], [1, \"fas\", \"fa-trophy\", \"mr-1\"], [\"id\", \"performance-table\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"h1\", 5);\n            i0.ɵɵtext(6, \"Dashboard\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"div\", 4)(8, \"ol\", 6)(9, \"li\", 7)(10, \"a\", 8);\n            i0.ɵɵtext(11, \"Home\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"li\", 9);\n            i0.ɵɵtext(13, \"Dashboard\");\n            i0.ɵɵelementEnd()()()()()();\n            i0.ɵɵelementStart(14, \"section\", 10)(15, \"div\", 2);\n            i0.ɵɵelement(16, \"div\", 11);\n            i0.ɵɵtemplate(17, DashboardComponent_div_17_Template, 3, 0, \"div\", 12)(18, DashboardComponent_div_18_Template, 2, 1, \"div\", 13)(19, DashboardComponent_div_19_Template, 49, 4, \"div\", 14)(20, DashboardComponent_div_20_Template, 32, 0, \"div\", 15);\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(17);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i2.NgIf],\n        styles: [\".content-wrapper[_ngcontent-%COMP%]{padding:1rem}.dashboard-grid[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.dashboard-card[_ngcontent-%COMP%]{flex:1 1 320px;min-width:260px}.recent-activity[_ngcontent-%COMP%]{max-height:300px;overflow:auto;padding:.5rem;background:#fff;border:1px solid #ececec;border-radius:6px}.stat-badge[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}