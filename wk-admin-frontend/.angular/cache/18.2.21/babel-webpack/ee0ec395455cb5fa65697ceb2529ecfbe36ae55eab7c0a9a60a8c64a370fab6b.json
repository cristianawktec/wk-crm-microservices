{"ast":null,"code":"import Chart from 'chart.js/auto';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/api.service\";\nimport * as i2 from \"@angular/common\";\nfunction DashboardComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15);\n    i0.ɵɵelement(1, \"i\", 16);\n    i0.ɵɵtext(2, \" Carregando dados...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nfunction DashboardComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\", 19)(2, \"div\", 20)(3, \"div\", 21)(4, \"h3\", 22);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 23);\n    i0.ɵɵtext(8, \"Total Clientes\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(9, \"div\", 24);\n    i0.ɵɵelement(10, \"i\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"a\", 26);\n    i0.ɵɵtext(12, \"Mais info \");\n    i0.ɵɵelement(13, \"i\", 27);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(14, \"div\", 19)(15, \"div\", 28)(16, \"div\", 21)(17, \"h3\", 22);\n    i0.ɵɵtext(18);\n    i0.ɵɵpipe(19, \"currency\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p\", 23);\n    i0.ɵɵtext(21, \"Vendas do M\\u00EAs\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"div\", 24);\n    i0.ɵɵelement(23, \"i\", 29);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"a\", 30);\n    i0.ɵɵtext(25, \"Mais info \");\n    i0.ɵɵelement(26, \"i\", 27);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(27, \"div\", 19)(28, \"div\", 31)(29, \"div\", 21)(30, \"h3\", 22);\n    i0.ɵɵtext(31);\n    i0.ɵɵpipe(32, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"p\", 23);\n    i0.ɵɵtext(34, \"Oportunidades Ativas\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(35, \"div\", 24);\n    i0.ɵɵelement(36, \"i\", 32);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"a\", 33);\n    i0.ɵɵtext(38, \"Mais info \");\n    i0.ɵɵelement(39, \"i\", 27);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(40, \"div\", 19)(41, \"div\", 34)(42, \"div\", 21)(43, \"h3\", 22);\n    i0.ɵɵtext(44);\n    i0.ɵɵpipe(45, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(46, \"p\", 23);\n    i0.ɵɵtext(47, \"Tickets Abertos\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(48, \"div\", 24);\n    i0.ɵɵelement(49, \"i\", 35);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"a\", 36);\n    i0.ɵɵtext(51, \"Mais info \");\n    i0.ɵɵelement(52, \"i\", 27);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    let tmp_1_0;\n    let tmp_2_0;\n    let tmp_3_0;\n    let tmp_4_0;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(6, 4, (tmp_1_0 = (tmp_1_0 = ctx_r0.stats.total_clientes) !== null && tmp_1_0 !== undefined ? tmp_1_0 : ctx_r0.stats.total_customers) !== null && tmp_1_0 !== undefined ? tmp_1_0 : 0));\n    i0.ɵɵadvance(13);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind4(19, 6, (tmp_2_0 = (tmp_2_0 = ctx_r0.stats.receita_mes) !== null && tmp_2_0 !== undefined ? tmp_2_0 : ctx_r0.stats.salesThisMonth) !== null && tmp_2_0 !== undefined ? tmp_2_0 : 0, \"BRL\", \"symbol\", \"1.2-2\"));\n    i0.ɵɵadvance(13);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(32, 11, (tmp_3_0 = (tmp_3_0 = ctx_r0.stats.leads_ativos) !== null && tmp_3_0 !== undefined ? tmp_3_0 : ctx_r0.stats.activeOpportunities) !== null && tmp_3_0 !== undefined ? tmp_3_0 : 0));\n    i0.ɵɵadvance(13);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind1(45, 13, (tmp_4_0 = (tmp_4_0 = ctx_r0.stats.tickets_abertos) !== null && tmp_4_0 !== undefined ? tmp_4_0 : ctx_r0.stats.supportTickets) !== null && tmp_4_0 !== undefined ? tmp_4_0 : 0));\n  }\n}\nfunction DashboardComponent_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 37)(1, \"section\", 38)(2, \"div\", 39)(3, \"div\", 40)(4, \"h3\", 41);\n    i0.ɵɵelement(5, \"i\", 42);\n    i0.ɵɵtext(6, \"Vendas Mensais\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 43)(8, \"div\", 44)(9, \"div\", 45);\n    i0.ɵɵelement(10, \"canvas\", 46);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(11, \"div\", 39)(12, \"div\", 40)(13, \"h3\", 41);\n    i0.ɵɵelement(14, \"i\", 47);\n    i0.ɵɵtext(15, \"Atividade Recente\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 43)(17, \"div\", 48)(18, \"div\", 49);\n    i0.ɵɵelement(19, \"i\", 16);\n    i0.ɵɵtext(20, \" Carregando atividades...\");\n    i0.ɵɵelementEnd()()()()();\n    i0.ɵɵelementStart(21, \"section\", 50)(22, \"div\", 39)(23, \"div\", 40)(24, \"h3\", 41);\n    i0.ɵɵelement(25, \"i\", 51);\n    i0.ɵɵtext(26, \"Performance de Vendedores\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"div\", 43)(28, \"div\", 52)(29, \"div\", 49);\n    i0.ɵɵelement(30, \"i\", 16);\n    i0.ɵɵtext(31, \" Carregando performance...\");\n    i0.ɵɵelementEnd()()()()()();\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(api) {\n      this.api = api;\n      this.loading = true;\n      this.stats = {};\n      this.errorMessage = null;\n    }\n    ngOnInit() {\n      this.loadStats();\n    }\n    loadStats() {\n      this.loading = true;\n      this.api.getDashboard().subscribe({\n        next: v => {\n          if (v && v.resumo) {\n            this.stats = v.resumo;\n          } else if (v) {\n            // legacy / fallback format\n            this.stats = {\n              total_customers: v.totalCustomers || 0,\n              receita_mes: v.salesThisMonth || 0,\n              leads_ativos: v.activeOpportunities || 0,\n              tickets_abertos: v.supportTickets || 0\n            };\n          } else {\n            this.stats = {\n              total_customers: 0,\n              receita_mes: 0,\n              leads_ativos: 0,\n              tickets_abertos: 0\n            };\n          }\n          // If enhanced grafics available, render charts and feeds\n          if (v && v.dados_graficos) {\n            this.updateDashboardCharts(v.dados_graficos);\n          }\n          if (v && v.atividade_recente) {\n            this.updateActivityFeed(v.atividade_recente);\n          }\n          if (v && v.performance_vendedores) {\n            this.updatePerformanceTable(v.performance_vendedores);\n          }\n          this.loading = false;\n        },\n        error: err => {\n          this.loading = false;\n          this.errorMessage = 'Falha ao carregar o dashboard. Verifique se o backend está em execução.';\n          console.error('Dashboard load error', err);\n        }\n      });\n    }\n    updateDashboardCharts(dadosGraficos) {\n      try {\n        const vendas = (dadosGraficos.vendas_mes || []).slice(-30);\n        const revenueCtx = document.getElementById('revenue-chart-canvas')?.getContext('2d');\n        if (revenueCtx) {\n          // destroy existing chart instance if present\n          if (window.revenueChart instanceof Chart) window.revenueChart.destroy();\n          window.revenueChart = new Chart(revenueCtx, {\n            type: 'line',\n            data: {\n              labels: vendas.map(v => new Date(v.data).toLocaleDateString('pt-BR', {\n                month: 'short',\n                day: 'numeric'\n              })),\n              datasets: [{\n                label: 'Vendas (R$)',\n                data: vendas.map(v => v.valor || 0),\n                borderColor: 'rgb(75,192,192)',\n                backgroundColor: 'rgba(75,192,192,0.2)',\n                tension: 0.1\n              }]\n            },\n            options: {\n              responsive: true,\n              maintainAspectRatio: false\n            }\n          });\n        }\n        const salesCtx = document.getElementById('sales-chart-canvas')?.getContext('2d');\n        if (salesCtx) {\n          if (window.salesChart instanceof Chart) window.salesChart.destroy();\n          window.salesChart = new Chart(salesCtx, {\n            type: 'bar',\n            data: {\n              labels: vendas.map(v => new Date(v.data).toLocaleDateString('pt-BR', {\n                month: 'short',\n                day: 'numeric'\n              })),\n              datasets: [{\n                label: 'Vendas',\n                data: vendas.map(v => v.vendas || 0),\n                backgroundColor: 'rgba(54,162,235,0.6)'\n              }]\n            },\n            options: {\n              responsive: true,\n              maintainAspectRatio: false\n            }\n          });\n        }\n      } catch (err) {\n        console.warn('Erro ao renderizar charts', err);\n      }\n    }\n    updateActivityFeed(atividadeRecente) {\n      const activityContainer = document.querySelector('.activity-feed') || document.querySelector('#activity-feed');\n      if (!activityContainer) return;\n      const activityHtml = atividadeRecente.map(atividade => `\n      <div class=\"activity-item\">\n        <i class=\"fas fa-${atividade.tipo || 'info-circle'} activity-icon\"></i>\n        <div class=\"activity-content\">\n          <p class=\"activity-text\">${atividade.descricao || atividade.title || ''}</p>\n          <small class=\"activity-time text-muted\">${atividade.tempo || atividade.time || ''}</small>\n        </div>\n      </div>\n    `).join('');\n      activityContainer.innerHTML = activityHtml;\n    }\n    updatePerformanceTable(performanceVendedores) {\n      const tableContainer = document.querySelector('#performance-table') || document.querySelector('.performance-table');\n      if (!tableContainer) return;\n      const tableHtml = `\n      <table class=\"table table-striped\">\n        <thead><tr><th>Vendedor</th><th>Vendas</th><th>Leads</th><th>Conversão</th><th>Meta</th><th>Atingimento</th></tr></thead>\n        <tbody>\n          ${performanceVendedores.map(v => `\n            <tr>\n              <td>${v.nome}</td>\n              <td>${v.vendas}</td>\n              <td>${v.leads}</td>\n              <td>${(v.conversao || 0).toFixed ? v.conversao.toFixed(1) + '%' : v.conversao}</td>\n              <td>${v.meta}</td>\n              <td><span class=\"badge badge-${v.atingimento >= 90 ? 'success' : v.atingimento >= 70 ? 'warning' : 'danger'}\">${(v.atingimento || 0).toFixed ? v.atingimento.toFixed(1) + '%' : v.atingimento}</span></td>\n            </tr>\n          `).join('')}\n        </tbody>\n      </table>\n    `;\n      tableContainer.innerHTML = tableHtml;\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || DashboardComponent)(i0.ɵɵdirectiveInject(i1.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        decls: 20,\n        vars: 4,\n        consts: [[1, \"content-header\"], [1, \"container-fluid\"], [1, \"row\", \"mb-2\"], [1, \"col-sm-6\"], [1, \"m-0\"], [1, \"breadcrumb\", \"float-sm-right\"], [1, \"breadcrumb-item\"], [\"href\", \"#\"], [1, \"breadcrumb-item\", \"active\"], [1, \"content\"], [\"id\", \"alert-container\"], [\"id\", \"stats-loading\", \"class\", \"text-center\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [\"class\", \"row\", \"id\", \"dashboard-container\", 4, \"ngIf\"], [\"class\", \"row\", 4, \"ngIf\"], [\"id\", \"stats-loading\", 1, \"text-center\"], [1, \"fas\", \"fa-spinner\", \"fa-spin\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\"], [\"id\", \"dashboard-container\", 1, \"row\"], [1, \"col-lg-3\", \"col-6\"], [\"data-card\", \"total-customers\", 1, \"small-box\", \"bg-info\"], [1, \"inner\"], [1, \"card-value\"], [1, \"card-label\"], [1, \"icon\"], [1, \"fas\", \"fa-users\"], [\"href\", \"#/customers\", 1, \"small-box-footer\"], [1, \"fas\", \"fa-arrow-circle-right\"], [\"data-card\", \"monthly-sales\", 1, \"small-box\", \"bg-success\"], [1, \"fas\", \"fa-chart-line\"], [\"href\", \"#/sales\", 1, \"small-box-footer\"], [\"data-card\", \"active-opportunities\", 1, \"small-box\", \"bg-warning\"], [1, \"fas\", \"fa-handshake\"], [\"href\", \"#/opportunities\", 1, \"small-box-footer\"], [\"data-card\", \"support-tickets\", 1, \"small-box\", \"bg-danger\"], [1, \"fas\", \"fa-ticket-alt\"], [\"href\", \"#/support\", 1, \"small-box-footer\"], [1, \"row\"], [1, \"col-lg-7\", \"connectedSortable\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"fas\", \"fa-chart-pie\", \"mr-1\"], [1, \"card-body\"], [1, \"tab-content\", \"p-0\"], [\"id\", \"revenue-chart\", 1, \"chart\", \"tab-pane\", \"active\", 2, \"position\", \"relative\", \"height\", \"300px\"], [\"id\", \"revenue-chart-canvas\", \"height\", \"300\", 2, \"height\", \"300px\"], [1, \"fas\", \"fa-clock\", \"mr-1\"], [\"id\", \"activity-feed\", 1, \"activity-feed\"], [1, \"text-center\"], [1, \"col-lg-5\", \"connectedSortable\"], [1, \"fas\", \"fa-trophy\", \"mr-1\"], [\"id\", \"performance-table\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h1\", 4);\n            i0.ɵɵtext(5, \"Dashboard\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 3)(7, \"ol\", 5)(8, \"li\", 6)(9, \"a\", 7);\n            i0.ɵɵtext(10, \"Home\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(11, \"li\", 8);\n            i0.ɵɵtext(12, \"Dashboard\");\n            i0.ɵɵelementEnd()()()()()();\n            i0.ɵɵelementStart(13, \"section\", 9)(14, \"div\", 1);\n            i0.ɵɵelement(15, \"div\", 10);\n            i0.ɵɵtemplate(16, DashboardComponent_div_16_Template, 3, 0, \"div\", 11)(17, DashboardComponent_div_17_Template, 2, 1, \"div\", 12)(18, DashboardComponent_div_18_Template, 53, 15, \"div\", 13)(19, DashboardComponent_div_19_Template, 32, 0, \"div\", 14);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(16);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i2.NgIf, i2.DecimalPipe, i2.CurrencyPipe],\n        styles: [\".content-wrapper[_ngcontent-%COMP%]{padding:1rem}.dashboard-grid[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.dashboard-card[_ngcontent-%COMP%]{flex:1 1 320px;min-width:260px}.recent-activity[_ngcontent-%COMP%]{max-height:300px;overflow:auto;padding:.5rem;background:#fff;border:1px solid #ececec;border-radius:6px}.stat-badge[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700}.card-value[_ngcontent-%COMP%]{font-size:1.6rem;margin:0;font-weight:700}.card-label[_ngcontent-%COMP%]{margin:0;font-size:.9rem;color:#0009}.card[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{min-height:260px}.small-box[_ngcontent-%COMP%]{position:relative;color:#fff;border-radius:8px;padding:12px 16px;overflow:hidden}.small-box[_ngcontent-%COMP%]   .inner[_ngcontent-%COMP%]{padding-right:80px}.small-box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{position:absolute;right:12px;top:10px;font-size:40px;opacity:.15}.small-box[_ngcontent-%COMP%]   .small-box-footer[_ngcontent-%COMP%]{display:block;color:#fffffff2;padding:8px 0 0;margin-top:8px;text-decoration:none}.activity-feed[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.activity-item[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:flex-start;padding:8px;border-bottom:1px solid #f1f1f1}.activity-icon[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#f4f6f9;display:flex;align-items:center;justify-content:center;color:#444}.activity-content[_ngcontent-%COMP%]{flex:1}.activity-text[_ngcontent-%COMP%]{margin:0 0 4px;font-size:.95rem}.activity-time[_ngcontent-%COMP%]{font-size:.8rem;color:#888}#performance-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}#performance-table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:.4rem .55rem;border-radius:6px}@media (max-width: 991px){.small-box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:32px;right:8px;top:8px}.card[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{min-height:200px}}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}