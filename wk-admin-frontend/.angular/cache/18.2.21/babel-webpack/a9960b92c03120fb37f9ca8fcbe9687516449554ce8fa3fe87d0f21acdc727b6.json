{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/api.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nfunction OpportunitiesFormComponent_option_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", c_r1.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r1.name || c_r1.full_name || c_r1.title || c_r1.company);\n  }\n}\nfunction OpportunitiesFormComponent_option_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngValue\", s_r2.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(s_r2.name || s_r2.full_name || s_r2.title);\n  }\n}\nexport let OpportunitiesFormComponent = /*#__PURE__*/(() => {\n  class OpportunitiesFormComponent {\n    constructor(fb, api, route, router) {\n      this.fb = fb;\n      this.api = api;\n      this.route = route;\n      this.router = router;\n      this.loading = false;\n      this.isEdit = false;\n      this.id = null;\n      this.customers = [];\n      this.sellers = [];\n      this.form = this.fb.group({\n        title: ['', Validators.required],\n        client_id: [null],\n        seller_id: [null],\n        value: [null],\n        currency: ['BRL'],\n        probability: [null],\n        status: ['open'],\n        close_date: [null]\n      });\n    }\n    ngOnInit() {\n      this.loadSelects();\n      this.id = this.route.snapshot.paramMap.get('id');\n      this.isEdit = !!this.id && this.id !== 'new';\n      if (this.isEdit && this.id) this.loadEntity(this.id);\n    }\n    loadSelects() {\n      this.api.getCustomers().subscribe({\n        next: r => {\n          this.customers = r?.data || r || [];\n        },\n        error: () => {}\n      });\n      this.api.getSellers().subscribe({\n        next: r => {\n          this.sellers = r?.data || r || [];\n        },\n        error: () => {}\n      });\n    }\n    loadEntity(id) {\n      this.loading = true;\n      this.api.getOpportunity(id).subscribe({\n        next: res => {\n          const data = res?.data || res || {};\n          this.form.patchValue({\n            title: data.title,\n            client_id: data.client_id || data.customer_id || null,\n            seller_id: data.seller_id || null,\n            value: data.value || null,\n            currency: data.currency || 'BRL',\n            probability: data.probability || null,\n            status: data.status || 'open',\n            close_date: data.close_date || null\n          });\n          this.loading = false;\n        },\n        error: err => {\n          this.loading = false;\n          alert('Erro ao carregar oportunidade');\n        }\n      });\n    }\n    submit() {\n      if (this.form.invalid) return this.form.markAllAsTouched();\n      const payload = this.form.value;\n      this.loading = true;\n      if (this.isEdit && this.id) {\n        this.api.updateOpportunity(this.id, payload).subscribe({\n          next: () => {\n            this.loading = false;\n            this.router.navigate(['/opportunities']);\n          },\n          error: () => {\n            this.loading = false;\n            alert('Erro ao atualizar');\n          }\n        });\n      } else {\n        this.api.createOpportunity(payload).subscribe({\n          next: () => {\n            this.loading = false;\n            this.router.navigate(['/opportunities']);\n          },\n          error: () => {\n            this.loading = false;\n            alert('Erro ao criar');\n          }\n        });\n      }\n    }\n    cancel() {\n      this.router.navigate(['/opportunities']);\n    }\n    static {\n      this.ɵfac = function OpportunitiesFormComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || OpportunitiesFormComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: OpportunitiesFormComponent,\n        selectors: [[\"app-opportunity-form\"]],\n        decls: 56,\n        vars: 7,\n        consts: [[1, \"content\"], [1, \"container-fluid\"], [1, \"row\"], [1, \"col-8\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"card-body\"], [3, \"ngSubmit\", \"formGroup\"], [1, \"form-group\"], [\"formControlName\", \"title\", 1, \"form-control\"], [\"formControlName\", \"client_id\", 1, \"form-control\"], [3, \"ngValue\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [\"formControlName\", \"seller_id\", 1, \"form-control\"], [1, \"form-row\"], [1, \"form-group\", \"col-md-4\"], [\"formControlName\", \"value\", \"type\", \"number\", \"step\", \"0.01\", 1, \"form-control\"], [\"formControlName\", \"probability\", \"type\", \"number\", 1, \"form-control\"], [\"formControlName\", \"close_date\", \"type\", \"date\", 1, \"form-control\"], [\"formControlName\", \"status\", 1, \"form-control\"], [\"value\", \"open\"], [\"value\", \"won\"], [\"value\", \"lost\"], [1, \"form-group\", \"mt-3\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\"], [\"type\", \"button\", 1, \"btn\", \"btn-secondary\", \"ml-2\", 3, \"click\"]],\n        template: function OpportunitiesFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"div\", 5)(6, \"h3\", 6);\n            i0.ɵɵtext(7);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(8, \"div\", 7)(9, \"form\", 8);\n            i0.ɵɵlistener(\"ngSubmit\", function OpportunitiesFormComponent_Template_form_ngSubmit_9_listener() {\n              return ctx.submit();\n            });\n            i0.ɵɵelementStart(10, \"div\", 9)(11, \"label\");\n            i0.ɵɵtext(12, \"T\\u00EDtulo\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(13, \"input\", 10);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(14, \"div\", 9)(15, \"label\");\n            i0.ɵɵtext(16, \"Cliente\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(17, \"select\", 11)(18, \"option\", 12);\n            i0.ɵɵtext(19, \"-- Selecionar --\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(20, OpportunitiesFormComponent_option_20_Template, 2, 2, \"option\", 13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"div\", 9)(22, \"label\");\n            i0.ɵɵtext(23, \"Vendedor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(24, \"select\", 14)(25, \"option\", 12);\n            i0.ɵɵtext(26, \"-- Selecionar --\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(27, OpportunitiesFormComponent_option_27_Template, 2, 2, \"option\", 13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(28, \"div\", 15)(29, \"div\", 16)(30, \"label\");\n            i0.ɵɵtext(31, \"Valor\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(32, \"input\", 17);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(33, \"div\", 16)(34, \"label\");\n            i0.ɵɵtext(35, \"Probabilidade (%)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(36, \"input\", 18);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(37, \"div\", 16)(38, \"label\");\n            i0.ɵɵtext(39, \"Data de Fechamento\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(40, \"input\", 19);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(41, \"div\", 9)(42, \"label\");\n            i0.ɵɵtext(43, \"Status\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(44, \"select\", 20)(45, \"option\", 21);\n            i0.ɵɵtext(46, \"Aberta\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(47, \"option\", 22);\n            i0.ɵɵtext(48, \"Ganha\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(49, \"option\", 23);\n            i0.ɵɵtext(50, \"Perdida\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(51, \"div\", 24)(52, \"button\", 25);\n            i0.ɵɵtext(53, \"Salvar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(54, \"button\", 26);\n            i0.ɵɵlistener(\"click\", function OpportunitiesFormComponent_Template_button_click_54_listener() {\n              return ctx.cancel();\n            });\n            i0.ɵɵtext(55, \"Cancelar\");\n            i0.ɵɵelementEnd()()()()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(7);\n            i0.ɵɵtextInterpolate1(\"\", ctx.isEdit ? \"Editar\" : \"Nova\", \" Oportunidade\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"formGroup\", ctx.form);\n            i0.ɵɵadvance(9);\n            i0.ɵɵproperty(\"ngValue\", null);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.customers);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngValue\", null);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.sellers);\n            i0.ɵɵadvance(25);\n            i0.ɵɵproperty(\"disabled\", ctx.loading);\n          }\n        },\n        dependencies: [i4.NgForOf, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName],\n        encapsulation: 2\n      });\n    }\n  }\n  return OpportunitiesFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}