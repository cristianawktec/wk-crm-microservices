{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../services/api.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nconst _c0 = () => [\"/leads\"];\nfunction LeadFormComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8)(1, \"div\", 9)(2, \"span\", 10);\n    i0.ɵɵtext(3, \"Carregando...\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction LeadFormComponent_div_9_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 36);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(s_r3);\n  }\n}\nfunction LeadFormComponent_div_9_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 37);\n    i0.ɵɵelement(1, \"input\", 38);\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LeadFormComponent_div_9_option_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 36);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r4.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(s_r4.name || s_r4.nome);\n  }\n}\nfunction LeadFormComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"form\", 11);\n    i0.ɵɵlistener(\"ngSubmit\", function LeadFormComponent_div_9_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.save());\n    });\n    i0.ɵɵelementStart(2, \"div\", 12)(3, \"div\", 13)(4, \"h3\", 14);\n    i0.ɵɵtext(5, \"Informa\\u00E7\\u00F5es do Lead\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 15)(7, \"div\", 16)(8, \"label\", 17);\n    i0.ɵɵtext(9, \"Nome\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(10, \"input\", 18);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 16)(12, \"label\", 17);\n    i0.ɵɵtext(13, \"Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(14, \"input\", 19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"div\", 16)(16, \"label\", 17);\n    i0.ɵɵtext(17, \"Telefone\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(18, \"input\", 20);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"div\", 16)(20, \"label\", 17);\n    i0.ɵɵtext(21, \"Fonte\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(22, \"select\", 21)(23, \"option\", 22);\n    i0.ɵɵtext(24, \"\\u2014 Selecionar fonte \\u2014\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(25, LeadFormComponent_div_9_option_25_Template, 2, 2, \"option\", 23);\n    i0.ɵɵelementStart(26, \"option\", 24);\n    i0.ɵɵtext(27, \"Outro...\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(28, LeadFormComponent_div_9_div_28_Template, 2, 0, \"div\", 25);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(29, \"div\", 16)(30, \"label\", 17);\n    i0.ɵɵtext(31, \"Status\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(32, \"select\", 26)(33, \"option\", 27);\n    i0.ɵɵtext(34, \"Novo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(35, \"option\", 28);\n    i0.ɵɵtext(36, \"Contactado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"option\", 29);\n    i0.ɵɵtext(38, \"Qualificado\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(39, \"option\", 30);\n    i0.ɵɵtext(40, \"Convertido\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"option\", 31);\n    i0.ɵɵtext(42, \"Perdido\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(43, \"div\", 16)(44, \"label\", 17);\n    i0.ɵɵtext(45, \"Vendedor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(46, \"select\", 32)(47, \"option\", 22);\n    i0.ɵɵtext(48, \"\\u2014 Selecionar vendedor \\u2014\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(49, LeadFormComponent_div_9_option_49_Template, 2, 2, \"option\", 23);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(50, \"div\", 33)(51, \"button\", 34);\n    i0.ɵɵtext(52, \"Salvar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(53, \"a\", 35);\n    i0.ɵɵtext(54, \"Cancelar\");\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    let tmp_3_0;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.form);\n    i0.ɵɵadvance(24);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.sources);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ((tmp_3_0 = ctx_r1.form.get(\"source\")) == null ? null : tmp_3_0.value) === \"other\");\n    i0.ɵɵadvance(21);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.sellers);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(5, _c0));\n  }\n}\nexport let LeadFormComponent = /*#__PURE__*/(() => {\n  class LeadFormComponent {\n    constructor(fb, api, route, router) {\n      this.fb = fb;\n      this.api = api;\n      this.route = route;\n      this.router = router;\n      this.loading = true;\n      this.currentId = null;\n      this.sellers = [];\n      this.sources = [];\n      this.form = this.fb.group({\n        name: ['', Validators.required],\n        email: ['', Validators.email],\n        phone: [''],\n        source: [''],\n        source_custom: [''],\n        status: ['new'],\n        seller_id: ['']\n      });\n    }\n    ngOnInit() {\n      this.loadSellers();\n      this.loadSources();\n      const id = this.route.snapshot.paramMap.get('id');\n      if (id && id !== 'new') {\n        this.currentId = id;\n        this.loadLead(id);\n      } else {\n        this.loading = false;\n      }\n    }\n    loadLead(id) {\n      this.loading = true;\n      this.api.getLead(id).subscribe({\n        next: res => {\n          // ensure seller_id is present in the form if returned\n          const payload = Object.assign({}, res);\n          if (res.seller_id) payload.seller_id = res.seller_id;\n          this.form.patchValue(payload);\n          this.loading = false;\n        },\n        error: () => {\n          alert('Erro ao carregar lead');\n          this.loading = false;\n        }\n      });\n    }\n    loadSellers() {\n      this.api.getSellers().subscribe({\n        next: res => {\n          if (Array.isArray(res)) this.sellers = res;else this.sellers = res?.data || res || [];\n        },\n        error: err => {\n          console.warn('Could not load sellers', err);\n          this.sellers = [];\n        }\n      });\n    }\n    loadSources() {\n      this.api.getLeadSources().subscribe({\n        next: res => {\n          if (Array.isArray(res)) this.sources = res;else this.sources = res?.data || res || [];\n        },\n        error: err => {\n          console.warn('Could not load lead sources', err);\n          this.sources = [];\n        }\n      });\n    }\n    save() {\n      if (this.form.invalid) return;\n      this.loading = true;\n      const payload = Object.assign({}, this.form.value);\n      if (payload.source === 'other' && payload.source_custom) {\n        payload.source = payload.source_custom;\n      }\n      // remove helper field\n      delete payload.source_custom;\n      if (this.currentId) {\n        this.api.updateLead(this.currentId, payload).subscribe({\n          next: () => this.onSaved(),\n          error: () => {\n            alert('Erro ao salvar');\n            this.loading = false;\n          }\n        });\n      } else {\n        this.api.createLead(payload).subscribe({\n          next: () => this.onSaved(),\n          error: () => {\n            alert('Erro ao salvar');\n            this.loading = false;\n          }\n        });\n      }\n    }\n    onSaved() {\n      this.loading = false;\n      // navigate back to list with saved query param to show success\n      this.router.navigate(['/leads'], {\n        queryParams: {\n          saved: '1'\n        }\n      });\n    }\n    static {\n      this.ɵfac = function LeadFormComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || LeadFormComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LeadFormComponent,\n        selectors: [[\"app-lead-form\"]],\n        decls: 10,\n        vars: 2,\n        consts: [[1, \"content-header\"], [1, \"container-fluid\"], [1, \"row\", \"mb-2\"], [1, \"col-sm-6\"], [1, \"m-0\"], [1, \"content\"], [\"class\", \"text-center py-4\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"text-center\", \"py-4\"], [\"role\", \"status\", 1, \"spinner-border\"], [1, \"visually-hidden\"], [3, \"ngSubmit\", \"formGroup\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-title\"], [1, \"card-body\"], [1, \"mb-3\"], [1, \"form-label\"], [\"formControlName\", \"name\", 1, \"form-control\"], [\"formControlName\", \"email\", 1, \"form-control\"], [\"formControlName\", \"phone\", 1, \"form-control\"], [\"formControlName\", \"source\", 1, \"form-control\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"value\", \"other\"], [\"class\", \"mt-2\", 4, \"ngIf\"], [\"formControlName\", \"status\", 1, \"form-control\"], [\"value\", \"new\"], [\"value\", \"contacted\"], [\"value\", \"qualified\"], [\"value\", \"converted\"], [\"value\", \"lost\"], [\"formControlName\", \"seller_id\", 1, \"form-control\"], [1, \"card-footer\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [1, \"btn\", \"btn-secondary\", \"ms-2\", 3, \"routerLink\"], [3, \"value\"], [1, \"mt-2\"], [\"formControlName\", \"source_custom\", \"placeholder\", \"Digite a fonte\", 1, \"form-control\"]],\n        template: function LeadFormComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"h1\", 4);\n            i0.ɵɵtext(5, \"Lead\");\n            i0.ɵɵelementEnd()()()()();\n            i0.ɵɵelementStart(6, \"section\", 5)(7, \"div\", 1);\n            i0.ɵɵtemplate(8, LeadFormComponent_div_8_Template, 4, 0, \"div\", 6)(9, LeadFormComponent_div_9_Template, 55, 6, \"div\", 7);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName, i3.RouterLink],\n        encapsulation: 2\n      });\n    }\n  }\n  return LeadFormComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}