<div class="container-fluid p-4">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Relatórios & Analytics</h1>
      <p class="text-gray-600 mt-1">Análise detalhada de vendas e oportunidades</p>
    </div>
    <div class="flex gap-2">
      <button 
        (click)="exportPDF()"
        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center gap-2"
      >
        <i class="fas fa-file-pdf"></i>
        Exportar PDF
      </button>
      <button 
        (click)="exportExcel()"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2"
      >
        <i class="fas fa-file-excel"></i>
        Exportar Excel
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Período</label>
        <select 
          [(ngModel)]="selectedPeriod"
          (change)="onYearChange()"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        >
          <option value="month">Mês</option>
          <option value="quarter">Trimestre</option>
          <option value="year">Ano</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Ano</label>
        <select 
          [(ngModel)]="selectedYear"
          (change)="onYearChange()"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        >
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>
      </div>
      <div *ngIf="selectedPeriod === 'month'">
        <label class="block text-sm font-medium text-gray-700 mb-2">Mês</label>
        <select 
          [(ngModel)]="selectedMonth"
          (change)="onMonthChange()"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        >
          <option value="1">Janeiro</option>
          <option value="2">Fevereiro</option>
          <option value="3">Março</option>
          <option value="4">Abril</option>
          <option value="5">Maio</option>
          <option value="6">Junho</option>
          <option value="7">Julho</option>
          <option value="8">Agosto</option>
          <option value="9">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
    <div *ngFor="let i of [1,2,3,4]" class="bg-white rounded-xl shadow-sm p-6 animate-pulse">
      <div class="h-4 bg-gray-200 rounded w-3/4 mb-4"></div>
      <div class="h-8 bg-gray-200 rounded w-1/2"></div>
    </div>
  </div>

  <!-- KPIs -->
  <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div 
      *ngFor="let kpi of kpis; let i = index"
      class="bg-white rounded-xl shadow-sm p-6 border-l-4"
      [ngClass]="getKpiClass(i)"
    >
      <div class="flex items-center justify-between">
        <div>
          <p class="text-sm font-medium text-gray-600">{{ kpi.name }}</p>
          <p class="text-2xl font-bold text-gray-900 mt-2">{{ kpi.formatted }}</p>
        </div>
        <div class="text-4xl opacity-10" [ngClass]="'text-' + kpi.color + '-600'">
          <i [ngClass]="'fas fa-' + kpi.icon"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row 1 -->
  <div *ngIf="!loading" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Monthly Sales Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Vendas Mensais (12 meses)</h3>
      <div class="h-80 flex items-center justify-center text-gray-500">
        <p>Gráfico: Tendência de vendas mensais</p>
      </div>
      <!-- Chart.js integration will go here -->
      <div class="mt-4 space-y-2">
        <div *ngFor="let month of monthlySales" class="flex items-center justify-between text-sm">
          <span class="text-gray-600">{{ month.month }}</span>
          <span class="font-semibold text-indigo-600">{{ month.formatted_value }}</span>
        </div>
      </div>
    </div>

    <!-- Status Distribution Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Distribuição por Status</h3>
      <div class="space-y-3">
        <div *ngFor="let status of statusDistribution" class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div 
              class="w-3 h-3 rounded-full"
              [style.backgroundColor]="status.color"
            ></div>
            <span class="text-gray-700">{{ status.status }}</span>
          </div>
          <div class="text-right">
            <span class="font-semibold text-gray-900">{{ status.count }}</span>
            <span class="text-gray-500 ml-2">({{ status.percentage }}%)</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Row 2 -->
  <div *ngIf="!loading" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Top Sellers Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Top 5 Vendedores</h3>
      <div class="space-y-4">
        <div *ngFor="let seller of topSellers" class="flex items-center justify-between">
          <div class="flex-1">
            <p class="font-semibold text-gray-900">{{ seller.seller_name }}</p>
            <p class="text-sm text-gray-500">{{ seller.opportunity_count }} oportunidades</p>
          </div>
          <div class="text-right">
            <p class="font-bold text-indigo-600">{{ formatCurrency(seller.total_value) }}</p>
            <p class="text-xs text-gray-500">Média: {{ formatCurrency(seller.average_value) }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Sales Funnel Chart -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-lg font-bold text-gray-900 mb-4">Funil de Vendas</h3>
      <div class="space-y-3">
        <div *ngFor="let stage of salesFunnel" class="flex items-center gap-3">
          <div class="flex-1">
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm font-medium text-gray-700">{{ stage.status }}</span>
              <span class="text-sm font-bold text-gray-900">{{ stage.count }}</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div 
                class="h-2 rounded-full"
                [style.width.%]="stage.percentage"
                [style.backgroundColor]="stage.color"
              ></div>
            </div>
            <div class="mt-1 flex justify-between text-xs text-gray-500">
              <span>{{ stage.percentage }}%</span>
              <span>{{ formatCurrency(stage.value) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div *ngIf="!loading" class="bg-white rounded-xl shadow-sm p-4 text-center text-gray-500 text-sm">
    Dados atualizados em {{ 'now' | date: 'dd/MM/yyyy HH:mm' }}
  </div>
</div>
