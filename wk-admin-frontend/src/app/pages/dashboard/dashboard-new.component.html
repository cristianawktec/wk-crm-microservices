<div class="content-header">
  <div class="container-fluid">
    <div class="row mb-2">
      <div class="col-sm-6"><h1 class="m-0">Dashboard</h1></div>
      <div class="col-sm-6"><ol class="breadcrumb float-sm-right"><li class="breadcrumb-item"><a href="#">Home</a></li><li class="breadcrumb-item active">Dashboard</li></ol></div>
    </div>
  </div>
</div>

<section class="content">
  <div class="container-fluid">
    <div *ngIf="loading" class="text-center py-5">
      <i class="fas fa-spinner fa-spin fa-3x text-primary"></i>
      <p class="mt-3">Carregando dados...</p>
    </div>
    
    <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle"></i> {{ errorMessage }}
    </div>

    <div *ngIf="!loading" class="row">
      <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
          <div class="inner">
            <h3>{{ stats.customers?.total || 0 }}</h3>
            <p>Total Clientes</p>
            <small class="text-white-50">Ativos: {{ stats.customers?.active || 0 }}</small>
          </div>
          <div class="icon"><i class="fas fa-users"></i></div>
          <a href="#/customers" class="small-box-footer">Mais info <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
          <div class="inner">
            <h3>{{ (stats.opportunities?.total_value || 0) | currency:'BRL':'symbol':'1.0-0' }}</h3>
            <p>Valor Total Oportunidades</p>
            <small class="text-white-50">Ganho: {{ stats.opportunities?.won || 0 }}</small>
          </div>
          <div class="icon"><i class="fas fa-dollar-sign"></i></div>
          <a href="#/opportunities" class="small-box-footer">Mais info <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
          <div class="inner">
            <h3 class="text-white">{{ stats.leads?.total || 0 }}</h3>
            <p class="text-white">Total Leads</p>
            <small class="text-white-50">Abertos: {{ stats.leads?.open || 0 }} | Convertidos: {{ stats.leads?.converted || 0 }}</small>
          </div>
          <div class="icon"><i class="fas fa-star"></i></div>
          <a href="#/leads" class="small-box-footer">Mais info <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>

      <div class="col-lg-3 col-6">
        <div class="small-box bg-primary">
          <div class="inner">
            <h3 class="text-white">{{ stats.opportunities?.total || 0 }}</h3>
            <p class="text-white">Oportunidades</p>
            <small class="text-white-50">Pendentes: {{ stats.opportunities?.pending || 0 }} | Perdidas: {{ stats.opportunities?.lost || 0 }}</small>
          </div>
          <div class="icon"><i class="fas fa-handshake"></i></div>
          <a href="#/opportunities" class="small-box-footer">Mais info <i class="fas fa-arrow-circle-right"></i></a>
        </div>
      </div>
    </div>

    <div *ngIf="!loading" class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title"><i class="fas fa-chart-bar"></i> Resumo Geral</h3>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-3 col-sm-6">
                <div class="info-box">
                  <span class="info-box-icon bg-info"><i class="fas fa-user-check"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">Clientes Ativos</span>
                    <span class="info-box-number">{{ stats.customers?.active || 0 }}</span>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="info-box">
                  <span class="info-box-icon bg-success"><i class="fas fa-trophy"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">Oportunidades Ganhas</span>
                    <span class="info-box-number">{{ stats.opportunities?.won || 0 }}</span>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="info-box">
                  <span class="info-box-icon bg-warning"><i class="fas fa-star-half-alt"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">Leads Abertos</span>
                    <span class="info-box-number">{{ stats.leads?.open || 0 }}</span>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="info-box">
                  <span class="info-box-icon bg-danger"><i class="fas fa-times-circle"></i></span>
                  <div class="info-box-content">
                    <span class="info-box-text">Leads Fechados</span>
                    <span class="info-box-number">{{ stats.leads?.closed || 0 }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>
